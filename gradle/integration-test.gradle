sourceSets {
  integrationTest {
    java.srcDir file('src/integTest/java')
    resources.srcDir file('src/integTest/resources')
    compileClasspath += sourceSets.main.output + configurations.testRuntimeClasspath
    runtimeClasspath += output + compileClasspath
  }
}

task integrationTest(type: Test) {
  description = 'Runs the integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  mustRunAfter test
}

// small batches of ITs to avoid memory errors on CI. will be run in parallel workflows.
task it1(type: Test) {
  description = 'Runs small batch of integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  includes = ['**/ScanIT_Gradle_Versions_4_2*.class']
  mustRunAfter test
}
task it2(type: Test) {
  description = 'Runs small batch of integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  includes = ['**/ScanIT_Gradle_Versions_4_5*.class']
  mustRunAfter test
}
task it3(type: Test) {
  description = 'Runs small batch of integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  includes = ['**/ScanIT_Gradle_Versions_4_8*.class']
  mustRunAfter test
}
task it4(type: Test) {
  description = 'Runs small batch of integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  includes = ['**/ScanIT_Gradle_Versions_5_1*.class']
  mustRunAfter test
}
task it5(type: Test) {
  description = 'Runs small batch of integration tests.'
  group = 'verification'
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
  maxHeapSize = '1536m'
  includes = ['**/ScanIT_Gradle_Versions_5_4*.class']
  mustRunAfter test
}

check.dependsOn integrationTest
